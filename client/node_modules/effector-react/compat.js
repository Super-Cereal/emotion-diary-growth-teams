'use strict';function e(e){return e&&'object'==typeof e&&'default'in e?e.default:e}function t(e,t,n,r){var u=[d.step.run({fn:function(e){return t(e)}})];if(r&&u.unshift(r),n){var o=d.createNode({node:u}),a=e.graphite.id,c=n.additionalLinks,i=c[a]||[];return c[a]=i,i.push(o),function(){var e=i.indexOf(o);-1!==e&&i.splice(e,1),d.clearNode(o)}}var s=d.createNode({node:u,parent:[e],family:{owners:e}});return function(){d.clearNode(s)}}function n(e,t){return t.displayName=e,t}function r(e,n){d.is.store(e)||b('expect useStore argument to be a store');var r=m.useCallback((function(r){return t(e,r,n)}),[e,n]),u=m.useCallback((function(){return h(e,n)}),[e,n]);return p.useSyncExternalStore(r,u,u)}function u(e,n){var r,u,o,a,c=e[0],i=e[1],s=S;if(i)r=i,o=c,a=[];else{r=c.fn,o=c.store,a=c.keys,u=c.defaultValue;var f=c.updateFilter;s=void 0===f?S:f}d.is.store(o)||b('useStoreMap expects a store'),Array.isArray(a)||b('useStoreMap expects an array as keys'),'function'!=typeof r&&b('useStoreMap expects a function');var l=m.useCallback((function(e){return t(o,e,n)}),[o,n]),v=m.useCallback((function(){return h(o,n)}),[o,n]),p=m.useRef(),x=m.useRef(),g=m.useRef(a);return y.useSyncExternalStoreWithSelector(l,v,v,(function(e){if(p.current!==e||!function(e,t){if(!e||!t||e.length!==t.length)return 0;for(var n=1,r=0;r<e.length;r++)if(e[r]!==t[r]){n=0;break}return n}(g.current,a)){var t=r(e,a);void 0===t&&void 0!==u&&(t=u),p.current=e,g.current=a,void 0!==t&&(x.current=t)}return x.current}),(function(e,t){return!s(t,e)}))}function o(e){var t=m.useContext(x);return e&&!t&&b('No scope found, consider adding <Provider> to app root'),t}function a(e,t){return r(e,o(null==t?void 0:t.forceScope))}function c(e,t){function r(e){var n=m.useRef(e),r=a(u);g((function(){return c({props:n.current,state:u.getState()}),function(){i({props:n.current,state:u.getState()})}}),[]);var o=t(e,r);return n.current=e,o}var u;d.is.store(e)?u=e:'object'==typeof e&&null!==e?u=d.combine(e):b('shape should be a store or object with stores');var o='Unknown';u&&u.shortName&&(o=u.shortName);var c=d.createEvent(),i=d.createEvent();return r.mounted=c,r.unmounted=i,n(o+".View",r)}function i(e,t){var n,r=t?e:e[0];(function(e){if(!e)throw Error('expect first argument be an object')})(C(n=r)||function(e){return'function'==typeof e}(n));var u=r.or,o=r.and;if(o){var a=t?o:o[0];if(C(a)&&'and'in a){var c=i(o,t);e=c[0],u=Object.assign({},u,c[1])}else e=o}return[e,u]}function s(e,t){void 0===t&&(t={});var n=m.useRef({value:null,count:0});g((function(){return e.open(n.current.value),function(){return e.close(n.current.value)}}),[e]),function(e,t){if(e===t)return 1;if('object'==typeof e&&null!==e&&'object'==typeof t&&null!==t){var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return 0;for(var u=0;u<n.length;u++){var o=n[u];if(e[o]!==t[o])return 0}return 1}return 0}(n.current.value,t)||(n.current.value=t,n.current.count+=1),g((function(){e.set(n.current.value)}),[n.current.count])}function f(e){function t(e){return o(t,e),null}var r=e.domain,u=e.defaultState,o=e.hook,a=E({or:e.maybeConfig,and:e.mainConfig}),c=(r?r.compositeName.fullName+"/":'')+(a.name||'gate'),i=d.createEvent({name:c+".set",sid:a.sid?a.sid+"|set":void 0}),s=d.createEvent({name:c+".open",sid:a.sid?a.sid+"|open":void 0}),f=d.createEvent({name:c+".close",sid:a.sid?a.sid+"|close":void 0}),l=d.createStore(Boolean(0),{name:c+".status",serialize:'ignore'}).on(s,(function(){return Boolean(1)})).on(f,(function(){return Boolean(0)})),v=d.createStore(u,{name:c+".state",sid:a.sid}).on(i,(function(e,t){return t})).on(s,(function(e,t){return t})).reset(f);if(r){var p=r.hooks;d.launch({target:[p.store,p.store,p.event,p.event,p.event],params:[l,v,s,f,i]})}return t.open=s,t.close=f,t.status=l,t.state=v,t.set=i,n("Gate:"+c,t)}function l(e,t){var n,r,u,o=i(t&&C(n=t[0])&&(n.and||n.or)?t:[{and:t}]),a=o[0],c=a[0],s=a[1],f={},l={},v=o[1];return'string'==typeof c?(l={name:c},C(u=s)&&'sid'in u||(f=s||{})):function(e){return C(e)&&('domain'in e||'defaultState'in e||'name'in e)}(c)&&(l=c,f=c.defaultState||{},r=c.domain),{hook:e,domain:r,defaultState:f,mainConfig:l,maybeConfig:v}}Object.defineProperty(exports,'__esModule',{value:1});var v=require('react'),d=require('effector/compat'),p=require('use-sync-external-store/shim/index.js'),y=require('use-sync-external-store/shim/with-selector.js'),m=e(v),b=function(e){throw Error(e)},h=function(e,t){return t?t.getState(e):e.getState()},S=function(e,t){return e!==t},x=m.createContext(null),g='undefined'!=typeof window?m.useLayoutEffect:m.useEffect,k=function(e){return console.error(e+" is deprecated")},j=function(e){return function(t){var r=e;return'function'!=typeof e&&(r=t,t=e),n("Connect("+(r.displayName||r.name||'Unknown')+")",(function(e){return m.createElement(r,Object.assign({},e,a(t)))}))}},C=function(e){return'object'==typeof e&&null!==e},E=function e(t,n){return void 0===n&&(n={}),C(t)&&(e(t.or,n),function(e){for(var t in e)u=t,function(e){return void 0===e}(r=e[t])||'or'===u||'and'===u||(n[u]=r);var r,u}(t),e(t.and,n)),n};exports.Provider=x.Provider,exports.connect=j,exports.createComponent=c,exports.createContextComponent=function(e,t,r){return k('createContextComponent'),n((e.shortName||'Unknown')+".ContextComponent",(function(n){var u=m.useContext(t),o=a(e);return r(n,o,u)}))},exports.createGate=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return f(l(s,t))},exports.createReactState=function(e,t){return k('createReactState'),j(t)(e)},exports.createStoreConsumer=function(e){return c(e,(function(e,t){return(0,e.children)(t)}))},exports.useEvent=function(e,t){return function(e,t){if(!t)return e;var n=d.is.unit(e)||'object'!=typeof e?{event:e}:e;return m.useMemo((function(){if(d.is.unit(e))return d.scopeBind(e,{scope:t});var n=Array.isArray(e)?[]:{};for(var r in e)n[r]=d.scopeBind(e[r],{scope:t});return n}),[t].concat(Object.keys(n),Object.values(n)))}(e,o(null==t?void 0:t.forceScope))},exports.useGate=s,exports.useList=function(e,t,a){return function(e,t,o){var a,c,i,s=[];'object'==typeof t&&null!==t?(t.keys&&(s=t.keys),a=t.fn,c=t.getKey,i=t.placeholder):a=t,d.is.store(e)||b('expect useList first argument to be a store'),'function'!=typeof a&&b("expect useList's renderItem to be a function"),Array.isArray(s)||b("expect useList's keys to be an array");var f=m.useMemo((function(){var t=n((e.shortName||'Unknown')+".Item",(function(t){var n=t.index,r=t.keys;if(l.current[1])return l.current[0](t.value,t.keyVal);var a=u([{store:e,keys:[n].concat(r),fn:function(e,t){return e[t[0]]}}],o);return l.current[0](a,n)}));return m.memo(t)}),[e,o,!!c]),l=m.useRef([a,c]);l.current=[a,c];var v=m.useMemo((function(){return s}),s);if(c){var p=r(e,o);return 0===p.length&&i?i:p.map((function(e){var t=l.current[1](e);return m.createElement(f,{keyVal:t,key:t,keys:v,value:e})}))}var y=u([{store:e,keys:[e],fn:function(e){return e.length}}],o);return 0===y&&i?i:Array.from({length:y},(function(e,t){return m.createElement(f,{index:t,key:t,keys:v})}))}(e,t,o(null==a?void 0:a.forceScope))},exports.useStore=a,exports.useStoreMap=function(e,t){return u([e,t],o(null==e?void 0:e.forceScope))},exports.useUnit=function(e,n){return function(e,n){var r=d.is.unit(e),u=r?{unit:e}:e,o=Array.isArray(u),a=m.useRef({stale:1,wasSubscribed:0,justSubscribed:0}),c=m.useMemo((function(){a.current.stale=1;var e=Array.isArray(u)?[]:{},t=[],r=[];for(var o in u){var c=u[o];d.is.unit(c)||b('expect useUnit argument to be a unit'),d.is.event(c)||d.is.effect(c)?e[o]=n?d.scopeBind(c,{scope:n}):c:(e[o]=null,t.push(o),r.push(c))}return[e,t,r]}),[a,n].concat(Object.keys(u),Object.values(u))),i=c[0],s=c[1],f=c[2],l=m.useRef({value:i,storeKeys:s}),v=m.useCallback((function(e){var r=a.current;r.wasSubscribed&&(r.justSubscribed=1);var u=function(){r.stale||(r.stale=1,e())},o=d.step.compute({priority:'sampler',batch:1}),c=f.map((function(e){return t(e,u,n,o)}));return r.wasSubscribed=1,function(){c.forEach((function(e){return e()}))}}),[f,n,l,a]),y=m.useCallback((function(){var e,t=l.current,u=a.current,c=0,v=t.value,d=t.storeKeys;if((s.length>0||d.length>0)&&(u.stale||u.justSubscribed)){c=!u.justSubscribed,e=o?[].concat(i):Object.assign({},i),d.length!==s.length&&(c=1);for(var p=0;p<s.length;p++){var y=h(f[p],n),m=s[p];c||(c=d.includes(m)?v[m]!==y:1),e[m]=y}}return c&&(t.value=e),t.storeKeys=s,u.stale=0,u.justSubscribed=!c,r?t.value.unit:t.value}),[v,a]);return p.useSyncExternalStore(v,y,y)}(e,o(null==n?void 0:n.forceScope))};
//# sourceMappingURL=compat.js.map
